@model PixelIt.ViewModel.Post.AddPostViewModel

@{ 
    ViewData["Title"] = "Add Post";
}

<form enctype="multipart/form-data" asp-action="CreatePost" method="post" class="container-fluid">
    <div class="mb-3">
        <label asp-for="Post.PostImage" class="form-label">Post Image</label>
        <input type="file" asp-for="Post.PostImage" />
        <small class="form-text text-muted">Insert here your Image</small>
        <span asp-validation-for="Post.PostImage" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Post.Description" class="form-label">Post Description</label>
        <input asp-for="Post.Description" class="form-control" />
        <span asp-validation-for="Post.Description" class="text-danger"></span>
    </div>
    <div class="mb-3">
        <label asp-for="Post.PostCategories" class="form-label">Post Category</label>
        <div class="border rounded p-3">
            <div class="mb-2">
                <div class="input-group">
                    <input type="text" id="categoryInput" class="form-control"
                           placeholder="Add your own category..." />
                    <button asp-action="" type="button" class="btn btn-outline-primary" onclick="addCategory()">
                        <i class="bi bi-plus"></i> Add
                    </button>
                </div>
                <small class="form-text text-muted">
                    Puoi aggiungere categorie personalizzate o selezionare da quelle esistenti
                </small>
            </div>
        @if ( ViewBag.Categories != null && ViewBag.Categories.Count > 0)
        {
            <div class="mb-3">
                <select id="existingCategory" class="form-select">
                    <option value="">-- Seleziona una categoria esistente --</option>
                    @foreach (var category in ViewBag.Categories)
                    {
                        <option value="@category.Name">@category.Name</option>
                    }
                 </select>
             </div>
        }
        <div id="newCategory" class="@(ViewBag.Categories != null && ViewBag.Categories.Count > 0)">
            <input asp-for="Category.CategoryName" class="form-control" />
            <span asp-validation-for="Category.CategoryName" class="text-danger"></span>
        </div>
        <div class="d-flex justify-content-between">
            <button type="submit" class="btn btn-primary">Crea Post</button>
            <a asp-action="Index" class="btn btn-secondary">Torna alla Home</a>
        </div>
    </div>
</form>


@section Script {
    @{await Html.RenderPartialAsync("_ValidationScriptPartial");}
}

<script>
    $('#existingCategory').change(function() {
                     $('#Category_Name').val($(this).val());
             });

    $('#Post_PostImage').on('input', function() {
        var path = $(this).val();
        if(path) {
            if ($('#imagePreview').lenght === 0) {
                $(this).after('<div class="mt-2"><img id="imagePreview" class="img-fluid rounded mt-2" style="max-height: 200px;" /></div>');
            }
			$('#imagePreview').attr('src', path);
        } else {
			$('#imagePreview').remove();
        }
    }
</script>



@* @section Scripts { *@
@*     @{await Html.RenderPartialAsync("_ValidationScriptsPartial");} *@
    
@*     <script> *@
@*         $(document).ready(function() { *@
@*             // Gestione della selezione categoria esistente o nuova *@
@*             $('#useNewCategory').change(function() { *@
@*                 if($(this).is(':checked')) { *@
@*                     $('#newCategoryInput').removeClass('d-none'); *@
@*                     $('#existingCategory').prop('disabled', true); *@
@*                 } else { *@
@*                     $('#newCategoryInput').addClass('d-none'); *@
@*                     $('#existingCategory').prop('disabled', false); *@
@*                 } *@
@*             }); *@
            
@*             // Copia la categoria esistente selezionata nel campo della nuova categoria *@
@*             $('#existingCategory').change(function() { *@
@*                 if(!$('#useNewCategory').is(':checked')) { *@
@*                     $('#Category_Name').val($(this).val()); *@
@*                 } *@
@*             }); *@
            
@*             // Anteprima dell'immagine *@
@*             $('#Post_ImageUrl').on('input', function() { *@
@*                 var url = $(this).val(); *@
@*                 if (url) { *@
@*                     if ($('#imagePreview').length === 0) { *@
@*                         $(this).after('<div class="mt-2"><img id="imagePreview" class="img-fluid rounded mt-2" style="max-height: 200px;" /></div>'); *@
@*                     } *@
@*                     $('#imagePreview').attr('src', url); *@
@*                 } else { *@
@*                     $('#imagePreview').remove(); *@
@*                 } *@
@*             }); *@
@*         }); *@
@*     </script> *@
@* } *@